!function(e){function t(t){for(var n,i,c=t[0],a=t[1],l=t[2],h=0,u=[];h<c.length;h++)i=c[h],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(d&&d(t);u.length;)u.shift()();return s.push.apply(s,l||[]),o()}function o(){for(var e,t=0;t<s.length;t++){for(var o=s[t],n=!0,c=1;c<o.length;c++){var a=o[c];0!==r[a]&&(n=!1)}n&&(s.splice(t--,1),e=i(i.s=o[0]))}return e}var n={},r={0:0},s=[];function i(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=n,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window.webpackJsonp=window.webpackJsonp||[],a=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var d=a;s.push([4,1]),o()}([,,,function(e,t,o){},function(e,t,o){"use strict";o.r(t);o(3);var n=o(0);let r={distance:30,densityData:[],zoomState:null,zoomExtent:[1,8],screen:{},colors:{gradientA:n.rgb(0,0,0),gradientB:n.rgb(60,60,60),contours:n.rgb(255,255,255,.5),tokens:n.rgb(255,255,255,.5),nodes:n.rgb(255,255,255,.5)},tokens:{}};var s=o.p+"nodes.json",i=o.p+"links.json";o(5);var c=()=>{(()=>{const e=n.extent(r.nodes,e=>Math.floor(e.x)),t=n.extent(r.nodes,e=>Math.floor(e.y)),o=e[1]-e[0],s=t[1]-t[0],i=e[0],c=t[0];r.densityData=n.contourDensity().x(e=>Math.floor(e.x)-i).y(e=>Math.floor(e.y)-c).weight(e=>e.relevancy).size([o,s]).cellSize(5).bandwidth(40).thresholds(15)(r.nodes),r.densityData.forEach(e=>e.coordinates=e.coordinates.map(e=>e.map(e=>e.map(e=>[e[0]+i,e[1]+c]))))})();const e=.8/r.densityData.length;let t=1;for(let o=r.densityData.length-1;o>=0;o--)r.context.beginPath(),r.context.strokeStyle=r.colors.contours,r.geoPath(r.densityData[o]),r.context.lineWidth=.8-e*t,t+=1,r.context.stroke()},a=()=>{const e=r.zoomState.x*r.screen.density,t=r.zoomState.y*r.screen.density,o=r.zoomState.k;r.screen.width=r.body.clientWidth*r.screen.density,r.screen.height=r.body.clientHeight*r.screen.density,r.context.scale(r.screen.density,r.screen.density),r.canvas.style("width",`${r.body.clientWidth}px`).style("height",`${r.body.clientHeight}px`).attr("width",r.screen.width).attr("height",r.screen.height),r.context.save(),r.context.clearRect(0,0,r.screen.width,r.screen.height),r.context.translate(e,t),r.context.scale(o,o),c(),(()=>{const e=Math.pow(r.distance,2)-500,t=Math.pow(2*r.distance,2)+500;for(let o=0;o<r.links.length;o++){const n=r.links[o],s=Math.abs(n.source.x-n.target.x),i=Math.abs(n.source.y-n.target.y),c=Math.pow(s,2)+Math.pow(i,2);if(e<c&&c<t){const e=Math.floor(s/2+(n.source.x<n.target.x?n.source.x:n.target.x)),t=Math.floor(i/2+(n.source.y<n.target.y?n.source.y:n.target.y));for(let[o,s]of Object.entries(n.tokens)){"function"==typeof r.tokens[o]&&r.tokens[o](e,t,s);break}}}})(),r.nodes.forEach(e=>{r.drawNode(Math.floor(e.x),Math.floor(e.y))}),r.context.restore()};window.s=r,r.zoomState=n.zoomIdentity;var l=()=>{n.select("#searchField").on("input",(function(){const e=r.nodes.find(e=>(console.log(this),-1!==e.id.toLowerCase().indexOf(this.value.toLowerCase())));n.select("#searchResults").html(""),n.select("#searchResults").append("p").html(`Press the key 'enter'<br>to focus on ${e.id}`),console.log("matching",e),r.zoomTo=e})).on("keypress",(function(){if(32===n.event.keyCode||13===n.event.keyCode){const e=8,t=(r.screen.width/2-r.zoomTo.x*e)/r.screen.density,o=(r.screen.height/2-r.zoomTo.y*e)/r.screen.density;r.zoomState=n.zoomIdentity.translate(t,o).scale(e),r.canvas.transition().duration(2e3).call(r.zoom.transform,r.zoomState)}}))};window.d3=n,window.s=r,Promise.all([n.json(s),n.json(i)]).then(([e,t])=>{r.links=t,r.nodes=e,console.log("nodes",r.nodes.length),console.log("links",r.links.length),(()=>{r.linkExtent=[],r.linkExtent[0]=r.links.reduce((e,t)=>{const o=Object.entries(t.tokens);for(const[t,n]of o)return e<n?e:n},1/0),r.linkExtent[1]=r.links.reduce((e,t)=>{const o=Object.entries(t.tokens);for(const[t,n]of o)return e>n?e:n},0),r.keywordScale=n.scaleLinear().domain(r.linkExtent).range([r.zoomExtent[1],r.zoomExtent[0]]),"devicePixelRatio"in window&&window.devicePixelRatio>1?r.screen.density=window.devicePixelRatio:r.screen.density=1,console.log("screen density:",r.screen.density),r.body=document.querySelector("body"),r.screen.width=r.body.clientWidth*r.screen.density,r.screen.height=r.body.clientHeight*r.screen.density,r.canvas=n.select("#visualization"),r.context=document.querySelector("#visualization").getContext("2d"),r.geoPath=n.geoPath().context(r.context);const e=document.createElement("canvas"),t=e.getContext("2d");t.width=10,t.height=10,t.fillStyle=r.colors.nodes,t.arc(10,10,10,0,2*Math.PI),t.fill(),r.drawNode=(t,o)=>{r.context.drawImage(e,t-1,o-1,.1*e.width,.1*e.height)};const o=r.nodes.reduce((e,t)=>{let o=0;for(let n in t.tokens)if(e.includes("token")||e.push(n),2==++o)break;return e},[]);console.log(o),o.forEach(e=>{const t=document.createElement("canvas"),o=t.getContext("2d");o.fillStyle=r.colors.tokens,o.font="100px Arial",o.textBaseline="top",o.fillText(e,0,0),r.tokens[e]=(e,o,n)=>{const s=n/5e3,i=Math.floor(t.width*s),c=Math.floor(t.height*s);r.context.drawImage(t,e,o,i,c)}})})(),(()=>{d3.select("#background").style("width",`${r.body.clientWidth}px`).style("height",`${r.body.clientHeight}px`).attr("width",r.screen.width).attr("height",r.screen.height);const e=document.querySelector("#background").getContext("2d",{alpha:!1}),t=e.createRadialGradient(r.screen.width/2,r.screen.height/2,0,r.screen.width/2,r.screen.height/2,r.screen.width/2);t.addColorStop(1,r.colors.gradientA),t.addColorStop(0,r.colors.gradientB),e.fillStyle=t,e.fillRect(0,0,r.screen.width,r.screen.height)})(),(()=>{const e=n.forceSimulation().force("collide",n.forceCollide().radius(r.distance).strength(.2).iterations(20)).force("center",n.forceCenter(r.screen.width/2,r.screen.height/2)).force("link",n.forceLink().id(e=>e.id).strength(e=>.2*e.value).iterations(20));e.nodes(r.nodes),e.force("link").links(r.links);e.on("tick",a).on("end",()=>{r.end=!0,a()}),window.onresize=function(){a()},r.zoom=n.zoom().on("zoom",()=>{r.zoomState=n.event.transform,a()}),r.zoom.scaleExtent(r.zoomExtent),r.zoom.scaleTo(r.canvas,r.zoomExtent[0]),r.canvas.call(r.zoom)})(),r.canvas.on("mousemove",()=>{const e=r.zoomState.invertX(event.x)*r.screen.density,t=r.zoomState.invertY(event.y)*r.screen.density;for(let o=r.nodes.length-1;o>=0;--o){const s=r.nodes[o],i=e-s.x,c=t-s.y;if(i*i+c*c<400){const e=Object.entries(s.tokens).reduce((e,t)=>(e.length<30&&e.push(`${t[0]} (${t[1]})`),e),[]);let t=`<h2><strong>${s.name}</strong></h2>`;t+=`<p>Number of papers: ${s.docs}</p>`,t+=`<p>Tokens:<br/>${e.join("<br/>")}</p>`,n.select("#focus").html(t)}}}),l()})}]);